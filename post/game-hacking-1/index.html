<!doctype html><html lang=fa dir=rtl><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>دستکاری سِیو بازی Car Mechanic Simulator 2015 | امنیت و غیره به فارسی</title><meta name=keywords content><meta name=description content="این کار &ldquo;هک&rdquo; نیست و با کاری که من در محل کارم انجام می‌دهم خیلی متفاوت است. ولی، دستکاری save این بازی فرصت خوبی است تا با یکسری از مفاهیم امنیت بازیهای کامپیوتری آشنا شویم.
اصل این نوشته را می‌توانید در بلاگ انگلیسی من بخوانید.
پیش زمینه دستکاری سِیو، یکی از قدیمی‌ترین و ساده‌ترین روشها برای تقلب در بازیهای کامپیوتری است. تقلب در بازی یکی از عوامل اصلی آشنایی افراد با مقوله امنیت است (در زبان انگلیسی به چنین چیزی gateway drug می‌گویند)."><meta name=author content="پارسیا"><link rel=canonical href=https://parsiya.github.io/parsiya.fa/post/game-hacking-1/><link href=/parsiya.fa/assets/css/stylesheet.min.d08f6c302eba3eaecd589684c093cecdfe7dfb8745a207401bd0583d3bb31837.css integrity="sha256-0I9sMC66Pq7NWJaEwJPOzf59+4dFogdAG9BYPTuzGDc=" rel="preload stylesheet" as=style><link rel=icon href=https://parsiya.github.io/parsiya.fa/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://parsiya.github.io/parsiya.fa/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://parsiya.github.io/parsiya.fa/favicon-32x32.png><link rel=apple-touch-icon href=https://parsiya.github.io/parsiya.fa/apple-touch-icon.png><link rel=mask-icon href=https://parsiya.github.io/parsiya.fa/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><meta name=generator content="Hugo 0.83.1"><link rel=stylesheet href=https://parsiya.github.io/parsiya.fa/css/vazir-font.css><link rel=stylesheet href=https://parsiya.github.io/parsiya.fa/css/custom.css><meta property="og:title" content="دستکاری سِیو بازی Car Mechanic Simulator 2015"><meta property="og:description" content="این کار &ldquo;هک&rdquo; نیست و با کاری که من در محل کارم انجام می‌دهم خیلی متفاوت است. ولی، دستکاری save این بازی فرصت خوبی است تا با یکسری از مفاهیم امنیت بازیهای کامپیوتری آشنا شویم.
اصل این نوشته را می‌توانید در بلاگ انگلیسی من بخوانید.
پیش زمینه دستکاری سِیو، یکی از قدیمی‌ترین و ساده‌ترین روشها برای تقلب در بازیهای کامپیوتری است. تقلب در بازی یکی از عوامل اصلی آشنایی افراد با مقوله امنیت است (در زبان انگلیسی به چنین چیزی gateway drug می‌گویند)."><meta property="og:type" content="article"><meta property="og:url" content="https://parsiya.github.io/parsiya.fa/post/game-hacking-1/"><meta property="article:section" content="post"><meta property="article:published_time" content="2021-05-15T17:57:56-07:00"><meta property="article:modified_time" content="2021-05-15T17:57:56-07:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="دستکاری سِیو بازی Car Mechanic Simulator 2015"><meta name=twitter:description content="این کار &ldquo;هک&rdquo; نیست و با کاری که من در محل کارم انجام می‌دهم خیلی متفاوت است. ولی، دستکاری save این بازی فرصت خوبی است تا با یکسری از مفاهیم امنیت بازیهای کامپیوتری آشنا شویم.
اصل این نوشته را می‌توانید در بلاگ انگلیسی من بخوانید.
پیش زمینه دستکاری سِیو، یکی از قدیمی‌ترین و ساده‌ترین روشها برای تقلب در بازیهای کامپیوتری است. تقلب در بازی یکی از عوامل اصلی آشنایی افراد با مقوله امنیت است (در زبان انگلیسی به چنین چیزی gateway drug می‌گویند)."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://parsiya.github.io/parsiya.fa/post/"},{"@type":"ListItem","position":2,"name":"دستکاری سِیو بازی Car Mechanic Simulator 2015","item":"https://parsiya.github.io/parsiya.fa/post/game-hacking-1/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"دستکاری سِیو بازی Car Mechanic Simulator 2015","name":"دستکاری سِیو بازی Car Mechanic Simulator 2015","description":"این کار \u0026ldquo;هک\u0026rdquo; نیست و با کاری که من در محل کارم انجام می‌دهم خیلی متفاوت است. ولی، دستکاری save این بازی فرصت خوبی است تا با یکسری از مفاهیم امنیت بازیهای کامپیوتری آشنا شویم.\nاصل این نوشته را می‌توانید در بلاگ انگلیسی من بخوانید.\nپیش زمینه دستکاری سِیو، یکی از قدیمی‌ترین و ساده‌ترین روشها برای تقلب در بازیهای کامپیوتری است. تقلب در بازی یکی از عوامل اصلی آشنایی افراد با مقوله امنیت است (در زبان انگلیسی به چنین چیزی gateway drug می‌گویند).","keywords":[],"articleBody":"این کار “هک” نیست و با کاری که من در محل کارم انجام می‌دهم خیلی متفاوت است. ولی، دستکاری save این بازی فرصت خوبی است تا با یکسری از مفاهیم امنیت بازیهای کامپیوتری آشنا شویم.\nاصل این نوشته را می‌توانید در بلاگ انگلیسی من بخوانید.\nپیش زمینه دستکاری سِیو، یکی از قدیمی‌ترین و ساده‌ترین روشها برای تقلب در بازیهای کامپیوتری است. تقلب در بازی یکی از عوامل اصلی آشنایی افراد با مقوله امنیت است (در زبان انگلیسی به چنین چیزی gateway drug می‌گویند). خیلی از افراد از جمله من از اینجا شروع کردیم و اولین قدمهای خود را با مهندسی معکوس ساختار سِیوهای بازی برداشتیم.\nهیچ وقت فکر نمی‌کردم که حقوق بگیرم که بازی کامپیوتری هک کنم.\nهدف ما در این بازی ما یک مکانیک هستیم که باید قطعات مختلف اتومبیل را عوض کند. دو مشخصه داریم:\n پول. تجربه یا experience.  هدف ما دستکاری سِیو بازی و تغییر این مقادیر است. سِیوهای بازی(نگارش Steam) در ویندوز در آدرس زیر ذخیره می‌شوند:\n%AppData%\\LocalLow\\Red Dot Games\\Car Mechanic Simulator 2015\\ در اینجا چند دایرکتوری داریم که هر کدام مخصوص یک پروفایل در بازی هستند و نام آنها profile0 و غیره است.\nاولین قدم: جستجوی اعداد در فایل اولین قدم همیشه تبدیل مقداری که می‌خواهیم عوض کنیم به مبنای 16 یا hex و جستجوی آن در فایل است. این کاری است که در اکثر بازیهای قدیمی جواب می‌دهد. مثلاً اولین دستکاری سِیو من در بازی Heroes of Might and Magic بود. فرض کنید در این بازی می‌خواستم تعداد Unicorn هایم را اضافه کنم. دو گروه 13 عددی تشکیل می‌دادم و بعد در فایل سِیو به دنبال 0D می‌گشتم. اگر دو مقدار نزدیک به هم پیدا می‌کردم آنها را به FF (یا 255) تغییر می‌دادم. اگر درست بود، که چه خوب وگرنه دوباره جستجو می‌کردم.\nدر بازی SimCity 2000 هم مقدار پول در مبنای 16 در فایل سِیو ذخیره میشد. نکته‌ای که در سِیو این بازی وجود داشت این بود که تعداد بایتها با افزایش عدد افزایش پیدا می‌کرد. مثلاً مقدار 10000 به صورت 0x2710 در دو بایت ذخیره میشد. برای افزایش پول اگر این دو بایت را به FF FF تغییر می‌دادم به 65535 می‌رسیدم که پول زیادی نبود. اما اگر خودم یک بایت به فایل اضافه می‌کردم دیگر فایل قابل بارگذاری نبود. این به احتمال زیاد برای این بود که offset قسمتهای مختلف فایل به هم می‌ریخت. برای حل این مشکل اول مقدار پول خود را به 65535 تغییر می‌دادم. سپس با انتشارjunk bond (چیزی شبیه اوراق مشارکت) مقدار پول خودم را اضافه می‌کردم تا نیاز به بایتهای بیشتری برای ذخیره آن باشد و سه بایت شود. سپس آن را به FF FF FF و یا 16 میلیون و خرده‌ای تغییر می‌دادم. با این کار دیگر احتیاجی به مهندسی معکوس بقیه فایل نبود و سریع به هدفم رسیدم.\nدر اینجا هم به دنبال 0x07D0 (معادل 2000 در مبنای 16) و کلمه money در کل فایلهای دایرکتوری یک پروفایل گشتم:\n$ grep -arb $'\\xd0\\x07' global:631:▒▒▒▒{~gameVer▒▒▒▒▒1.1.6.0{~date▒▒▒▒▒2017-11-28 22:56:20{ $ grep -arb money global:610:▒▒▒{~money این مقادیر در فایلی به نام global پیدا شدند:\nحدس آگاهانه یا educated guess یکی از مهمترین تواناییها در مهندسی معکوس حدس زدن آگاهانه است (فکر کنم ترجمه فارسی educated guess). یعنی با داشتن اطلاعاتی محدود و معمولاً بر اساس تجربه حدس می‌زنیم. سپس این حدس را امتحان می‌کنیم و اگر درست بود زمان معمولاً زیادی صرفه‌جویی شده است. اگر غلط بود حدسمان را با نتیجه آزمایش تغییر می‌دهیم و دوباره آزمایش می‌کنیم.\nمثلاً بعد از دیدن فایل با این فرمت من مطمئن هستم که این یک فایلِ serialize شده است. اینجا به نظر می‌رسد که فرمت مخصوص موتور بازی Unity است. بعد از دیکامپایل کردن بازی و جستجو در کد فهمیدم که از کتابخانه Easy Save 2 استفاده شده است.\nاین دو عدد به صورت little-endian در چهار بایت ذخیره شده اند. حدس من این است که این مقادیر در یک متغیر از نوع int 32 ذخیره شده‌اند. برای آزمایش حدس این مقادیر را به FF FF FF FF تغییر دادم.\nو بازی را شروع کردم اما نتیجه آن چیزی که می‌خواستم نبود. مقدار پول و تجربه منفی است.\nاین یعنی چه؟ این یعنی مقدارها در یک متغیر از نوع signed int 32 ذخیره می‌شوند. در یک متغیر signed اولین بیتِ بزرگترین بایت (یعنی بایت چهارم) مخصوص علامت عدد است (اگر صفر باشد مثبت است و اگر یک باشد منفی). اگر عدد منفی باشد بقیه عدد به صورت two’s complement (فارسیش واقعاً نمی‌دانم چه می‌شود) ذخیره می‌شود. برای بدست آوردن این مقدار همه بیت‌ها را تغییر می‌دهیم (اگر صفر بود یک می‌شود و برعکس) و سپس با یک جمع می‌کنیم. برای همین است که FF FF FF FF در واقع منفی یک است. برای داشتن بزرگترین عدد ممکن در یک signed int 32 باید عدد 7F FF FF FF را وارد کنیم.\nمشکل جدید و integer overflow اینجا فکر کردم کار من تمام شده و حواسم به integer overflow نبود. بعد از شروع بازی و کمی تجربه کسب کردن، تجربه‌ام دوباره منفی شد.\nچرا؟ چون مقدار در یک signed int 32 ذخیره می‌شود و ما بزرگترین عدد ممکن (max int) را در تجربه داشتیم. اضافه کردن یک به چنین عددی باعث می‌شود که integer overflow داشته باشیم و تبدیل به کوچکترین عدد ممکن شود. اضافه کردن 1 به 7F FF FF FF مقدار 00 00 00 80 را به ما می‌دهد که معادل min int است. بازی هم کنترلی برای چِک کردن این حالت ندارد چون در داخل بازی هیچ‌وقت به چنین مقدار پول یا تجربه‌ای نمی‌رسیم. برای حل این مشکل باید عددی کوچکتر وارد کنیم. مثلاً من مقدار 7F 00 00 00 را وارد کردم.\nآیا این یک مشکل امنیتی است؟ معمولاً دستکاری سِیو یک مشکل امنیتی (security issue) نیست. اکثر سِیوها برای بازیهای تک نفره (single player) هستند و مشکل امنیتی این بازیها بسیار محدود است. اگر بشود با چنین سِیو در یک بازی چند نفره (multiplayer) بازی کرد آن وقت مشکل داشتیم. مثلاً اگر این بازی یک حالت چند نفره داشت و همه با هم در یک تعمیرگاه کار می‌کردند آن وقت مشکل داشتیم.\nاکثر مشکلات بازیهای تک نفره امنیتی نیستند. مثلاً یکی از بازیهای تک نفره ما Jedi: Fallen Order است. اگر شما بتوانید در این بازی تقلب کنید تاثیری در بازی بقیه کاربران ندارد. هنگام تست امنیتی چنین بازی من این مسائل برایم مهم نیست.\nتنها حالتی که ممکن است دستکاری سِیو یک بازی فقط تک نفره مشکل امنیتی باشد وقتی است که باز کردن این سِیو در یک کامپیوتر دیگر باعث remote code execution یا دستکاری فایلهای کامپیوتر مقصد شود.\nاین مشکل در بازی Untitled Goose Game وجود داشت. این بازی هم با موتور Unity تولید شده است و سِیوهای این بازی هم serialize شده هستند و هنگام بارگذاری آن و deserialize کردن کنترلی ندارد. اطلاعات بیشتر را در لینک زیر می‌توانید بخوانید. چیز عجیبی نیست یک insecure deserialization کلاسیک دات‌نت است.\n https://pulsesecurity.co.nz/advisories/untitled-goose-game-deserialization  چی یاد گرفتیم؟ دستکاری سِیو این بازی بسیار ساده است اما ما را با مفاهیمی مانند serialization، معندسی معکوس فایل و int 32 آشنا کرد و دستگرمی خوبی است.\n","wordCount":"1146","inLanguage":"fa","datePublished":"2021-05-15T17:57:56-07:00","dateModified":"2021-05-15T17:57:56-07:00","author":{"@type":"Person","name":"پارسیا"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://parsiya.github.io/parsiya.fa/post/game-hacking-1/"},"publisher":{"@type":"Organization","name":"امنیت و غیره به فارسی","logo":{"@type":"ImageObject","url":"https://parsiya.github.io/parsiya.fa/favicon.ico"}}}</script></head><body class=dark id=top><script>localStorage.getItem("pref-theme")==="light"&&document.body.classList.remove('dark')</script><noscript><style type=text/css>#theme-toggle,.top-link{display:none}</style></noscript><header class=header><nav class=nav><div class=logo><a href=https://parsiya.github.io/parsiya.fa/ accesskey=h title="امنیت و غیره به فارسی (Alt + H)">امنیت و غیره به فارسی</a>
<span class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></span></div><ul id=menu onscroll=menu_on_scroll()></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://parsiya.github.io/parsiya.fa/>Home</a>&nbsp;»&nbsp;<a href=https://parsiya.github.io/parsiya.fa/post/>Posts</a></div><h1 class=post-title>دستکاری سِیو بازی Car Mechanic Simulator 2015</h1><div class=post-meta>May 15, 2021&nbsp;·&nbsp;پارسیا</div></header><div class=toc><details><summary accesskey=c title="(Alt + C)"><div class=details>فهرست مطالب</div></summary><div class=inner><ul><li><a href=#%d9%be%db%8c%d8%b4-%d8%b2%d9%85%db%8c%d9%86%d9%87 aria-label="پیش زمینه">پیش زمینه</a></li><li><a href=#%d9%87%d8%af%d9%81-%d9%85%d8%a7 aria-label="هدف ما">هدف ما</a></li><li><a href=#%d8%a7%d9%88%d9%84%db%8c%d9%86-%d9%82%d8%af%d9%85-%d8%ac%d8%b3%d8%aa%d8%ac%d9%88%db%8c-%d8%a7%d8%b9%d8%af%d8%a7%d8%af-%d8%af%d8%b1-%d9%81%d8%a7%db%8c%d9%84 aria-label="اولین قدم: جستجوی اعداد در فایل">اولین قدم: جستجوی اعداد در فایل</a></li><li><a href=#%d8%ad%d8%af%d8%b3-%d8%a2%da%af%d8%a7%d9%87%d8%a7%d9%86%d9%87-%db%8c%d8%a7-educated-guess aria-label="حدس آگاهانه یا educated guess">حدس آگاهانه یا educated guess</a></li><li><a href=#%d9%85%d8%b4%da%a9%d9%84-%d8%ac%d8%af%db%8c%d8%af-%d9%88-integer-overflow aria-label="مشکل جدید و integer overflow">مشکل جدید و integer overflow</a></li><li><a href=#%d8%a2%db%8c%d8%a7-%d8%a7%db%8c%d9%86-%db%8c%da%a9-%d9%85%d8%b4%da%a9%d9%84-%d8%a7%d9%85%d9%86%db%8c%d8%aa%db%8c-%d8%a7%d8%b3%d8%aa aria-label="آیا این یک مشکل امنیتی است؟">آیا این یک مشکل امنیتی است؟</a></li><li><a href=#%da%86%db%8c-%db%8c%d8%a7%d8%af-%da%af%d8%b1%d9%81%d8%aa%db%8c%d9%85 aria-label="چی یاد گرفتیم؟">چی یاد گرفتیم؟</a></li></ul></div></details></div><div class=post-content><p>این کار &ldquo;هک&rdquo; نیست و با کاری که من در <a href=https://www.ea.com/security>محل کارم</a> انجام می‌دهم خیلی
متفاوت است. ولی، دستکاری save این بازی فرصت خوبی است تا با یکسری از مفاهیم امنیت
بازیهای کامپیوتری آشنا شویم.</p><p>اصل این نوشته را می‌توانید در <a href=https://parsiya.net/blog/2017-11-29-hacking-car-mechanic-simulator-2015/>بلاگ انگلیسی من</a> بخوانید.</p><h1 id=پیش-زمینه>پیش زمینه<a hidden class=anchor aria-hidden=true href=#پیش-زمینه>#</a></h1><p>دستکاری سِیو، یکی از قدیمی‌ترین و ساده‌ترین روشها برای تقلب در بازیهای کامپیوتری
است. تقلب در بازی یکی از عوامل اصلی آشنایی افراد با مقوله امنیت است (در زبان
انگلیسی به چنین چیزی gateway drug می‌گویند). خیلی از افراد از جمله من از اینجا
شروع کردیم و اولین قدمهای خود را با مهندسی معکوس ساختار سِیوهای بازی برداشتیم.</p><p>هیچ وقت فکر نمی‌کردم که حقوق بگیرم که بازی کامپیوتری هک کنم.</p><h1 id=هدف-ما>هدف ما<a hidden class=anchor aria-hidden=true href=#هدف-ما>#</a></h1><p>در <a href=https://store.steampowered.com/app/320300/Car_Mechanic_Simulator_2015/>این بازی</a> ما یک مکانیک هستیم که باید قطعات مختلف اتومبیل را عوض کند. دو مشخصه داریم:</p><ol><li>پول.</li><li>تجربه یا experience.</li></ol><p>هدف ما دستکاری سِیو بازی و تغییر این مقادیر است. سِیوهای بازی(نگارش Steam) در ویندوز در آدرس زیر ذخیره می‌شوند:</p><pre><code>%AppData%\LocalLow\Red Dot Games\Car Mechanic Simulator 2015\
</code></pre><p>در اینجا چند دایرکتوری داریم که هر کدام مخصوص یک پروفایل در بازی هستند و نام آنها profile0 و غیره است.</p><h1 id=اولین-قدم-جستجوی-اعداد-در-فایل>اولین قدم: جستجوی اعداد در فایل<a hidden class=anchor aria-hidden=true href=#اولین-قدم-جستجوی-اعداد-در-فایل>#</a></h1><p>اولین قدم همیشه تبدیل مقداری که می‌خواهیم عوض کنیم به مبنای 16 یا hex و جستجوی
آن در فایل است. این کاری است که در اکثر بازیهای قدیمی جواب می‌دهد. مثلاً اولین
دستکاری سِیو من در بازی <a href=https://www.gog.com/game/heroes_of_might_and_magic>Heroes of Might and Magic</a> بود. فرض کنید
در این بازی می‌خواستم تعداد Unicorn هایم را اضافه کنم. دو گروه 13 عددی تشکیل
می‌دادم و بعد در فایل سِیو به دنبال <code>0D</code> می‌گشتم. اگر دو مقدار نزدیک به هم پیدا
می‌کردم آنها را به <code>FF</code> (یا 255) تغییر می‌دادم. اگر درست بود، که چه خوب وگرنه
دوباره جستجو می‌کردم.</p><p>در بازی <a href=https://www.origin.com/can/en-us/store/simcity/simcity-2000>SimCity 2000</a> هم مقدار پول در مبنای 16 در فایل
سِیو ذخیره میشد. نکته‌ای که در سِیو این بازی وجود داشت این بود که تعداد بایتها
با افزایش عدد افزایش پیدا می‌کرد. مثلاً مقدار <code>10000</code> به صورت <code>0x2710</code> در دو بایت
ذخیره میشد. برای افزایش پول اگر این دو بایت را به <code>FF FF</code> تغییر می‌دادم به <code>65535</code>
می‌رسیدم که پول زیادی نبود. اما اگر خودم یک بایت به فایل اضافه می‌کردم دیگر فایل
قابل بارگذاری نبود. این به احتمال زیاد برای این بود که offset قسمتهای مختلف فایل
به هم می‌ریخت. برای حل این مشکل اول مقدار پول خود را به <code>65535</code> تغییر می‌دادم. سپس
با انتشار<a href=https://simcity.fandom.com/wiki/Loan#SimCity_2000>junk bond</a> (چیزی شبیه اوراق مشارکت) مقدار پول خودم را اضافه می‌کردم تا
نیاز به بایتهای بیشتری برای ذخیره آن باشد و سه بایت شود. سپس آن را به <code>FF FF FF</code> و
یا 16 میلیون و خرده‌ای تغییر می‌دادم. با این کار دیگر احتیاجی به مهندسی معکوس بقیه فایل نبود و سریع به هدفم رسیدم.</p><p><img loading=lazy src=01-starting.jpg alt="مقدار پول و تجربه من در ابتدا"></p><p>در اینجا هم به دنبال <code>0x07D0</code> (معادل <code>2000</code> در مبنای 16) و کلمه <code>money</code> در کل
فایلهای دایرکتوری یک پروفایل گشتم:</p><pre><code>$ grep -arb $'\xd0\x07'
global:631:▒▒▒▒{~gameVer▒▒▒▒▒1.1.6.0{~date▒▒▒▒▒2017-11-28 22:56:20{
$ grep -arb money
global:610:▒▒▒{~money
</code></pre><p>این مقادیر در فایلی به نام <code>global</code> پیدا شدند:</p><p><img loading=lazy src=02-inside-global.png alt="تجربه و پول در فایل global"></p><h1 id=حدس-آگاهانه-یا-educated-guess>حدس آگاهانه یا educated guess<a hidden class=anchor aria-hidden=true href=#حدس-آگاهانه-یا-educated-guess>#</a></h1><p>یکی از مهمترین تواناییها در مهندسی معکوس حدس زدن آگاهانه است (فکر کنم ترجمه
فارسی educated guess). یعنی با داشتن اطلاعاتی محدود و معمولاً بر اساس تجربه
حدس می‌زنیم. سپس این حدس را امتحان می‌کنیم و اگر درست بود زمان معمولاً زیادی
صرفه‌جویی شده است. اگر غلط بود حدسمان را با نتیجه آزمایش تغییر می‌دهیم و دوباره
آزمایش می‌کنیم.</p><p>مثلاً بعد از دیدن فایل با این فرمت من مطمئن هستم که این یک فایلِ <a href=https://en.wikipedia.org/wiki/Serialization>serialize</a> شده
است. <del>اینجا به نظر می‌رسد که <a href=https://github.com/ata4/disunity/wiki/Serialized-file-format>فرمت مخصوص موتور بازی Unity</a> است</del>.
بعد از دیکامپایل کردن بازی و جستجو در کد فهمیدم که از کتابخانه <a href=https://docs.moodkie.com/product/easy-save-2/>Easy Save 2</a>
استفاده شده است.</p><p>این دو عدد به صورت
<a href=https://en.wikipedia.org/wiki/Endianness#Example>little-endian</a> در چهار بایت ذخیره شده اند. حدس من این است که این مقادیر در یک
متغیر از نوع int 32 ذخیره شده‌اند. برای آزمایش حدس این مقادیر را به <code>FF FF FF FF</code>
تغییر دادم.</p><p><img loading=lazy src=03-global-edited.png alt></p><p>و بازی را شروع کردم اما نتیجه آن چیزی که می‌خواستم نبود. مقدار پول و تجربه منفی است.</p><p><img loading=lazy src=04-after-edit1.jpg alt></p><p>این یعنی چه؟ این یعنی مقدارها در یک متغیر از نوع signed int 32 ذخیره می‌شوند. در
یک متغیر signed اولین بیتِ بزرگترین بایت (یعنی بایت چهارم) مخصوص علامت عدد است
(اگر صفر باشد مثبت است و اگر یک باشد منفی). اگر عدد منفی باشد بقیه عدد به صورت
<a href=https://en.wikipedia.org/wiki/Two%27s_complement>two&rsquo;s complement</a> (فارسیش واقعاً نمی‌دانم چه می‌شود)
ذخیره می‌شود. برای بدست آوردن این مقدار همه بیت‌ها را تغییر می‌دهیم (اگر صفر بود
یک می‌شود و برعکس) و سپس با یک جمع می‌کنیم. برای همین است که <code>FF FF FF FF</code> در
واقع منفی یک است. برای داشتن بزرگترین عدد ممکن در یک signed int 32 باید عدد <code>7F FF FF FF</code> را وارد کنیم.</p><p><img loading=lazy src=06-much-experience.jpg alt></p><h1 id=مشکل-جدید-و-integer-overflow>مشکل جدید و integer overflow<a hidden class=anchor aria-hidden=true href=#مشکل-جدید-و-integer-overflow>#</a></h1><p>اینجا فکر کردم کار من تمام شده و حواسم به integer overflow نبود. بعد از شروع بازی و کمی تجربه کسب کردن، تجربه‌ام دوباره منفی شد.</p><p><img loading=lazy src=07-int32-underflow.jpg alt></p><p>چرا؟ چون مقدار در یک signed int 32 ذخیره می‌شود و ما بزرگترین عدد ممکن (<a href=https://en.wikipedia.org/wiki/2,147,483,647>max
int</a>) را در تجربه داشتیم. اضافه کردن یک به چنین عددی باعث
می‌شود که <a href=https://en.wikipedia.org/wiki/Integer_overflow>integer overflow</a> داشته باشیم و تبدیل به
کوچکترین عدد ممکن شود. اضافه کردن 1 به <code>7F FF FF FF</code> مقدار <code>00 00 00 80</code> را به ما
می‌دهد که معادل min int است. بازی هم کنترلی برای چِک کردن این حالت ندارد چون در
داخل بازی هیچ‌وقت به چنین مقدار پول یا تجربه‌ای نمی‌رسیم. برای حل این مشکل باید
عددی کوچکتر وارد کنیم. مثلاً من مقدار <code>7F 00 00 00</code> را وارد کردم.</p><p><img loading=lazy src=08-monies.jpg alt></p><h1 id=آیا-این-یک-مشکل-امنیتی-است>آیا این یک مشکل امنیتی است؟<a hidden class=anchor aria-hidden=true href=#آیا-این-یک-مشکل-امنیتی-است>#</a></h1><p>معمولاً دستکاری سِیو یک مشکل امنیتی (security issue) نیست. اکثر سِیوها برای
بازیهای تک نفره (single player) هستند و مشکل امنیتی این بازیها بسیار محدود است.
اگر بشود با چنین سِیو در یک بازی چند نفره (multiplayer) بازی کرد آن وقت مشکل
داشتیم. مثلاً اگر این بازی یک حالت چند نفره داشت و همه با هم در یک تعمیرگاه کار
می‌کردند آن وقت مشکل داشتیم.</p><p>اکثر مشکلات بازیهای تک نفره امنیتی نیستند. مثلاً یکی از بازیهای تک نفره ما
<a href=https://www.ea.com/games/starwars/jedi-fallen-order>Jedi: Fallen Order</a> است. اگر شما بتوانید در این بازی تقلب
کنید تاثیری در بازی بقیه کاربران ندارد. هنگام تست امنیتی چنین بازی من این مسائل
برایم مهم نیست.</p><p>تنها حالتی که ممکن است دستکاری سِیو یک بازی فقط تک نفره مشکل امنیتی باشد وقتی
است که باز کردن این سِیو در یک کامپیوتر دیگر باعث remote code execution یا
دستکاری فایلهای کامپیوتر مقصد شود.</p><p>این مشکل در بازی <a href=https://goose.game/>Untitled Goose Game</a> وجود داشت. این بازی هم با
موتور Unity تولید شده است و سِیوهای این بازی هم serialize شده هستند و هنگام
بارگذاری آن و deserialize کردن کنترلی ندارد. اطلاعات بیشتر را در لینک زیر
می‌توانید بخوانید. چیز عجیبی نیست یک insecure deserialization کلاسیک دات‌نت
است.</p><ul><li><a href=https://pulsesecurity.co.nz/advisories/untitled-goose-game-deserialization>https://pulsesecurity.co.nz/advisories/untitled-goose-game-deserialization</a></li></ul><h1 id=چی-یاد-گرفتیم>چی یاد گرفتیم؟<a hidden class=anchor aria-hidden=true href=#چی-یاد-گرفتیم>#</a></h1><p>دستکاری سِیو این بازی بسیار ساده است اما ما را با مفاهیمی مانند serialization،
معندسی معکوس فایل و int 32 آشنا کرد و دستگرمی خوبی است.</p></div><footer class=post-footer></footer></article></main><footer class=footer><span>تحت مجوز <a href=https://creativecommons.org/licenses/by-nc/4.0/>کریتیو کامنز اختیار-غیرتجاری 4.0 بین‌المللی</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a></span>
<span>&#183;</span>
<span>Theme <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)"><button class=top-link id=top-link type=button accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></button></a>
<script defer src=/parsiya.fa/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script><script>window.onload=function(){localStorage.getItem("menu-scroll-position")&&(document.getElementById('menu').scrollLeft=localStorage.getItem("menu-scroll-position"))};function menu_on_scroll(){localStorage.setItem("menu-scroll-position",document.getElementById('menu').scrollLeft)}document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script></body></html>